worker_processes 1;

events {}

http {
    lua_shared_dict my_cache 10m;

    server {
        listen 80;

        location / {
            default_type application/json;
            content_by_lua_block {
                local cjson = require "cjson.safe"

                -- Collect request data
                local req = {}
                req.method = ngx.req.get_method()
                req.path   = ngx.var.uri
                req.query  = ngx.var.args or ""

                -- Headers
                local headers = ngx.req.get_headers()
                req.headers = headers

                -- Cookies (just split Cookie header)
                req.cookies = {}
                if headers["Cookie"] then
                    for k,v in string.gmatch(headers["Cookie"], "([^=; ]+)=([^;]+)") do
                        req.cookies[k] = v
                    end
                end

                ngx.say(cjson.encode(req))
            }
        }
    }
}